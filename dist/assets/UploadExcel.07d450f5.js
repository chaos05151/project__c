import{by as ae,bz as le,_ as oe,r as _,u as ne,a as se,o as h,c as k,d as i,e as a,w as s,g as p,bx as ue,b as x,h as r,V as N,aK as z,a5 as H,t as ce,p as re,i as de}from"./index.7723f14f.js";import{b as ie,c as _e,h as pe}from"./moment.59901b97.js";import{f as ve}from"./product.b0250884.js";var b={};Object.defineProperty(b,"__esModule",{value:!0});var me=ae.exports,fe=le;function B(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var he=B(me),ge=B(fe);let V=ge.default,w=null;const be=e=>{w=e},ye=()=>w=P;function xe(e,o){return!e||!o?e:e.replace(/\{(\w+)\}/g,(u,l)=>o[l])}const P=(...e)=>{const[o,u]=e;let l;const v=o.split(".");let g=V;for(let m=0,f=v.length;m<f;m++){const D=v[m];if(l=g[D],m===f-1)return xe(l,u);if(!l)return"";g=l}},Ve=(...e)=>w?w(...e)||P(...e):P(...e),M=e=>{V=e||V,V.name&&he.default.locale(V.name)},Ce=M;b.i18n=be;b.restoreHandler=ye;b.setLocale=Ce;b.t=Ve;b.use=M;const C=e=>(re("data-v-c7910f9e"),e=e(),de(),e),De={class:"crumbs"},ke=C(()=>i("i",{class:"el-icon-lx-calendar"},null,-1)),we=p(" \u89C4\u5219\u914D\u7F6E\u8868\u5BFC\u5165 "),Se=p("\u914D\u7F6E\u8868\u5BFC\u5165"),Ie={class:"container"},Ue={class:"handle-box"},je=p(" \u6E38\u620F\u9009\u62E9: "),Ee=p("\xA0 \u6E20\u9053\u9009\u62E9: "),Le=p("\xA0 \u7248\u672C\u9009\u62E9: "),Ne=p("\u914D\u7F6E\u8868\u5BFC\u5165\u5386\u53F2"),ze=C(()=>i("div",{class:"content-title"},"\u652F\u6301\u62D6\u62FD",-1)),He=C(()=>i("i",{class:"el-icon-upload"},null,-1)),Pe=C(()=>i("div",{class:"el-upload__text"},[p(" \u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216 "),i("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),Te=C(()=>i("div",{class:"el-upload__tip"},"\u53EA\u80FD\u4E0A\u4F20 xlsx/xls \u6587\u4EF6",-1)),qe=p(" \u4E00\u952E\u4E0A\u4F20 "),Be={class:"pagination"},Me={__name:"UploadExcel",setup(e){const o=_(""),u=_(""),l=_(""),v=_([]),g=_([]),m=_([]),f=_(1),D=_([]),S=_(ue),O=ne(),y=se({page_index:1,page_size:10}),T=_(1),Y=()=>{ve().then(c=>{console.log("fetchVersionProductChannelData",c.data),v.value=c.data}).catch(()=>{})},F=()=>{u.value="",l.value="",g.value=v.value.filter(c=>c.value==o.value)[0].children},J=()=>{l.value="",m.value=g.value.filter(c=>c.value==u.value)[0].children},R=()=>{o.value&&u.value&&l.value?(console.log("product_name_selected.value",o.value),console.log("channel_name_selected.value",u.value),console.log("version_name_selected.value",l.value),S.value.submit()):o.value?u.value?l.value||x.error("\u8BF7\u9009\u62E9\u7248\u672C\u53F7!"):x.error("\u8BF7\u9009\u62E9\u6E20\u9053!"):x.error("\u8BF7\u9009\u62E9\u6E38\u620F!")},K=c=>{if(f.value=2,o.value&&u.value&&l.value){let n=new FormData;n.append("file",c.file),n.append("product_id",o.value),n.append("channel",u.value),n.append("versions_b",l.value),ie(n).then(d=>{d.status==200?(f.value=3,x.success(d.message),I(),S.value.clearFiles()):(x.error(d==null?void 0:d.message),f.value=1),setTimeout(()=>{f.value=1},3e3)}).catch(()=>{})}},A=()=>{console.log(o.value,u.value,l.value),localStorage.setItem("productoptions",JSON.stringify(v.value)),localStorage.setItem("channeloptions",JSON.stringify(v.value[0].children)),localStorage.setItem("versionoptions",JSON.stringify(m.value)),O.push({name:"configimporthistory"})},I=c=>{_e(c).then(n=>{T.value=n.data.total_count,D.value=n.data.lists.map(d=>({...d,import_status:d.import_status=="1"?"\u5BFC\u5165\u6210\u529F":"\u5BFC\u5165\u5931\u8D25",updated_at:pe(d.updated_at).format("YYYY-MM-DD HH:mm:ss")}))}).catch(()=>{})},G=c=>{y.page_index=c,I(y)};return Y(),console.log("environment","production"),I(y),(c,n)=>{const d=r("el-breadcrumb-item"),Q=r("el-breadcrumb"),U=r("el-option"),j=r("el-select"),q=r("el-button"),E=r("el-step"),W=r("el-steps"),X=r("el-upload"),Z=r("el-divider"),L=r("el-table-column"),$=r("el-tag"),ee=r("el-table"),te=r("el-pagination");return h(),k("div",null,[i("div",De,[a(Q,{separator:"/"},{default:s(()=>[a(d,null,{default:s(()=>[ke,we]),_:1}),a(d,null,{default:s(()=>[Se]),_:1})]),_:1})]),i("div",Ie,[i("div",Ue,[je,a(j,{onChange:F,style:{width:"13%"},modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=t=>o.value=t),placeholder:"\u6E38\u620F\u9009\u62E9",class:"m-2"},{default:s(()=>[(h(!0),k(N,null,z(v.value,t=>(h(),H(U,{key:t.value,label:t.label_name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ee,a(j,{onChange:J,style:{width:"13%"},modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=t=>u.value=t),placeholder:"\u6E20\u9053\u9009\u62E9",class:"m-2"},{default:s(()=>[(h(!0),k(N,null,z(g.value,t=>(h(),H(U,{key:t.value,label:t.label_name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Le,a(j,{style:{width:"13%"},modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=t=>l.value=t),placeholder:"\u7248\u672C\u9009\u62E9",class:"m-2"},{default:s(()=>[(h(!0),k(N,null,z(m.value,t=>(h(),H(U,{key:t.value,label:t.label_name,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(q,{type:"primary",style:{"margin-left":"260px"},onClick:A},{default:s(()=>[Ne]),_:1})]),a(W,{active:f.value,"finish-status":"success"},{default:s(()=>[a(E,{title:"\u9009\u62E9\u6587\u4EF6"}),a(E,{title:"\u5BFC\u5165\u6570\u636E"}),a(E,{title:"\u5BFC\u5165\u5B8C\u6210"})]),_:1},8,["active"]),ze,a(X,{class:"upload-demo",drag:"",multiple:"",action:"","auto-upload":!1,ref_key:"upload",ref:S,"http-request":K},{trigger:s(()=>[He,Pe]),tip:s(()=>[Te]),default:s(()=>[i("div",null,[a(q,{class:"ml-3",type:"primary",onClick:R},{default:s(()=>[qe]),_:1})])]),_:1},512),a(Z),a(ee,{data:D.value,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header"},{default:s(()=>[a(L,{prop:"file_name",label:"\u6587\u4EF6\u540D\u79F0"}),a(L,{prop:"import_status",label:"\u72B6\u6001"},{default:s(t=>[a($,{type:t.row.import_status==="\u5BFC\u5165\u6210\u529F"?"success":t.row.import_status==="\u5BFC\u5165\u5931\u8D25"?"danger":""},{default:s(()=>[p(ce(t.row.import_status),1)]),_:2},1032,["type"])]),_:1}),a(L,{prop:"updated_at",label:"\u5BFC\u5165\u65F6\u95F4"})]),_:1},8,["data"]),i("div",Be,[a(te,{background:"",layout:"total, prev, pager, next","current-page":y.page_index,"page-size":y.page_size,total:T.value,onCurrentChange:G},null,8,["current-page","page-size","total"])])])])}}};var Je=oe(Me,[["__scopeId","data-v-c7910f9e"]]);export{Je as default};
